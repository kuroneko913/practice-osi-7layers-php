# 🧱 第1層：物理層（Physical Layer）を再発明する旅の記録

## 🎯 目的

> **OSIモデルの物理層を、自分の手でコードとして再構築しながら、その役割と限界を体感的に理解すること。**

---

## ✅ やったこと

### 1. `/tmp/bitfifo` を仮想的な「通信線」と見立てる
- 名前付きパイプ（FIFO）を使って、送信者と受信者を接続
- 送信側は `fwrite` でビットを1文字ずつ出力
- 受信側は `fgetc` で1ビットずつ読み取る

### 2. `PhysicalLayer` クラスを実装
- `send()`：1ビットを書き込み（+ `usleep` で疑似タイミング）
- `receive()`：1ビット読み取り
- クラス単体で第1層の責務を切り出し可能に

### 3. 実行構成を2ターミナルで再現
- ターミナルA: `php receiver.php`
- ターミナルB: `php sender.php`
- 実際の「2台のコンピュータ＋通信線」構成を模倣

---

## 🧠 学んだこと

| 気づき | 内容 |
|--------|------|
| 第1層は意味を扱わない | データの「区切り」「宛先」「正しさ」などはまったく扱わない |
| ビット単位の送受信ができれば“物理層”として成立する | 本質は「0/1の列が流れること」 |
| `/tmp/bitfifo` は仮想ケーブルである | 本物のLANケーブルの代わりに、UNIXの機能で再現できた |
| 同期や衝突制御は存在しない | 複数送信者がいても、受信側は判断できない＝次の層が必要 |
| 送信間隔を作るには `usleep` | タイミングの概念は明示的に入れないと再現できない |
| だからこそ、**第2層が必要になる** | 「誰に？どこまで？壊れてない？」＝意味の境界づけが欲しくなる |

---

## 🔁 構造としての完成形

```php
$physical = new PhysicalLayer('/tmp/bitfifo', 'w');
```

- `send("1")`, `receive()` のインターフェースで1ビット通信が再現可能
- 上位レイヤーが積みやすい構造に整理済み（`LayerInterface`対応）

---

## 🏆 チェックリストで理解も確認済み！

- [x] 物理層の役割は「ビット（0/1）の送受信」である
- [x] ビットは実際には電気/光/無線などで伝えられる
- [x] PHPでは `fwrite` / `fgetc` で再現できた
- [x] この層では「誰に送るか」「どこまでか」「壊れていないか」は扱わない
- [x] `usleep()` によって伝送タイミングを模倣できた
- [x] この層だけでは意味がないと実感 → 第2層へ進む動機が生まれた

---

## 📦 リポジトリの状態

- `PhysicalLayer.php` 実装済み ✅
- `/tmp/bitfifo` を使った再現構成 ✅
- GitHubリポジトリ：[kuroneko913/practice-osi-7layers-php](https://github.com/kuroneko913/practice-osi-7layers-php)
- Description:  
  > **Understanding the OSI model from scratch in PHP — one reinvented layer at a time.**

---

## 🚀 次のステップ：第2層（データリンク層）

- フレーム化
- 宛先/送信元アドレス（MAC相当）
- CRCによる整合性検証

→ **意味と正しさを与える層**が始まる！

written by ChatGPT.